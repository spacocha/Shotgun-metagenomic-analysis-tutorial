temp_freference=[26.13  24.51  21.70  24.96  18.37  23.97  27.76  25.07  27.65  27.13  9.021  26.62  12.87  24.52  12.59  12.92  9.354  24.68  22.71  24.88  23.05  27.72  25.54  17.29  23.11  9.387  12.59  24.56  25.24  26.34  18.96  20.27  10.76  11.86  13.84  27.00  18.71  28.6]';
salt_freference=[12.83  16.40  5.657  19.99  28.94  25.97  13.38  13.20  8.290  6.530  16.60  19.65  11.86  8.590  21.37  15.65  16.83  19.66  10.60  12.51  8.549  20.11  17.28  30.90  5.949  13.17  21.37  17.14  16.48  20.52  13.12  23.09  19.26  19.28  1.393  16.12  17.25  14.77]';
alk_freference=[1526.   1679.   1266.   1809.   2132.   2025.   1572.   1578.   1365.   1339.   1692.   1788.   1512.   1504.   1882.   1674.   1704.   1787.   1477.   1506.   1418.   1806.   1716.   2197.   1265.   1535.   1882.   1688.   1664.   1828.   1521.   1923.   1809.   1810.   972.2   1668.   1692.   1607]';
tic_freference=[1584.  1551.  1139.  1654.  1963.  1860.  1445.  1504.  1232.  1240.  1741.  1809.  1397.  1380.  1743.  1530.  1728.  1805.  1320.  1728.  1190.  1637.  1608.  2058.  983.0  1599.  1743.  1810.  1489.  1741.  1720.  1810.  1750.  1708.  1018.  1777.  1811.  1469]';
chl_freference=[7.849   9.555   32.17   8.166   4.948   5.174   13.64   14.20   19.71   31.18  0.9360   3.263   11.26   30.21   5.536   9.298   1.591   3.085   15.09   4.706   21.08   9.432   11.70   5.634   22.20   1.177   5.538   2.994   10.02   5.626   3.030   3.820   2.500   4.192   4.836   5.526   2.253   13.61]';
DO_freference=[59.13  239.7  315.8  233.3  205.7  195.6  225.6  216.3  238.6  223.9  166.1  47.30  340.2  273.7  298.1  320.2  183.9  24.14  228.2  6.906  277.5  223.0  220.6  179.9  289.3  194.9  298.1  0.9571  242.8  154.8  11.17  169.9  237.3  269.5  320.0  30.25  4.583  224.8]';
no3_freference=[ 0.002489  0.007971  13.95  0.005682  1.221  0.1450  0.009274  0.1268  0.007946  0.01404  10.95  1.521  13.59  1.266  0.07343  0.2180  8.812  0.3246  0.5910  9.476E-09  0.1441  0.009890  0.1261  3.103  0.1218  20.37  0.07360 -1.302E-10  0.007864  0.3961  4.509  0.5295  1.539  0.6705  47.66  0.004769  0.06347  0.00985]';
nh4_freference=[15.84  0.2270  3.426  0.2545  3.700  4.306  0.4524  2.571  0.3171  4.902  14.52  13.03  1.200  3.077  0.8765  0.6594  13.93  17.63  5.529  29.79  0.7370  0.1670  2.422  4.109  0.6657  13.08  0.8783  21.57  0.1490  7.042  25.27  10.12  8.590  5.438  6.708  16.42  22.78  0.4920]';
no2_freference=[3.100  2.269  5.105  2.064  2.600  1.976  3.470  2.487  3.173  3.249  6.544  5.206  3.912  3.005  1.910  2.713  5.906  4.388  5.726  0.4848  5.940  2.742  2.986  2.908  5.775  6.699  1.910  0.09660  3.503  2.939  2.597  3.333  3.125  2.386  2.008  1.845  1.094  3.077]';
po4_freference=[3.261  1.987  1.946  1.672  0.8317  1.623  1.552  2.778  2.137  2.253  1.856  2.986  1.114  2.475  0.2622  0.3134  1.614  2.632  1.249  4.456  0.8572  1.158  2.121  1.320  0.7698  2.291  0.2623  3.457  0.7659  2.162  3.858  1.230  0.8229  0.6089  3.146  3.862  2.964  1.40]';
refract_don_freference=[10.47   9.974   11.02   9.442   9.515   8.486   10.18   10.77   10.96   11.42   9.883   9.602   10.06   11.69   9.622   9.949   9.880   9.831   10.13   10.49   10.22   9.666   9.881   8.782   10.64   9.966   9.622   10.03   9.896   9.388   10.16   9.747   9.717   9.727   9.785   10.29   9.935   10.06]';
semilabile_don_freference=[8.233   4.693   12.00   4.190   4.782   3.431   7.441   5.897   10.35   13.32   11.30   3.798   11.50   11.51   9.046   11.19   11.35   6.461   11.65   9.023   12.18   5.638   4.658   3.824   12.52   10.99   9.046   6.844   8.722   3.913   11.41   7.298   10.17   9.889   9.866   5.012   10.63   7.162]';
semilabile_dop_freference=[0.5306  0.3065  0.7742  0.2705  0.3114  0.2189  0.4893  0.3887  0.6881  0.8628  0.7246  0.2367  0.7801  0.7403  0.6147  0.7662  0.7368  0.4062  0.7810  0.5584  0.8225  0.3682  0.2977  0.2428  0.8517  0.7019  0.6146  0.4263  0.5852  0.2473  0.7062  0.4754  0.6731  0.6677  0.6279  0.3131  0.6657  0.4700]';
phyto_freference=[5.476   8.624   21.14   8.153   3.980   4.658   11.82   10.94   15.06   20.75  0.7549   2.583   10.03   19.51   5.859   9.043   1.297   2.494   11.02   3.161   15.38   9.437   9.360   3.844   16.71  0.8793   5.860   2.240   9.825   4.870   2.031   3.120   2.281   3.820   3.132   3.884   1.611   12.00]';
h2s_freference=[0.02707  0.001112  0.003031  0.001192  0.001137  0.001675  0.001650  0.002311  0.005986  0.07971  7.185E-04  0.004983  1.641E-04  0.003949  7.751E-04  7.667E-04  8.346E-04  0.05244  0.001980  1.958  0.001938  0.001191  0.001703  8.772E-04  0.004911  2.851E-04  7.752E-04  1.488  0.001465  0.002470  0.1539  0.002798  0.001485  0.001287  6.171E-05  0.04140  0.3264  0.00203]';
[pco2_freference co3_freference hco3_freference co2aq_freference pH_freference]=pco2calc_b(tic_freference*1e-6,alk_freference*1e-6,temp_freference,salt_freference);

pprod_freference=[0.009198   2.198   23.53   1.207  0.04163  0.07953   3.931   10.46   5.294   26.14  1.691E-07  2.639E-08   8.436   19.58   2.230   4.058  4.559E-10  1.051E-08  0.8484  1.647E-08   9.125   1.411   8.555  0.005484   8.303  9.116E-09   2.158  1.778E-07   1.543  4.481E-07  4.491E-09  0.01329  2.040E-08  0.04635   2.672  1.694E-06  2.332E-09   3.45]';
nprod_freference=[1.343E-06  0.05278   6.270  0.02318  0.003858  0.001981  0.05265  0.5855  0.05424  0.08870  5.342E-09  7.317E-10   4.531   4.046  0.1107  0.8038  1.504E-11  1.252E-10  0.03604  7.125E-19   1.100  0.04129  0.3691  5.329E-04   1.062  3.258E-10  0.1069  0.0000  0.03719  1.329E-08  7.729E-11  3.320E-04  8.476E-10  0.002208  0.1875  5.103E-10  1.938E-12  0.03765]';
nitri1_freference=[0.6041  0.005236  0.04220  0.006471  0.09520  0.1071  0.009406  0.05393  0.005729  0.09707  0.7154  0.6181  0.01957  0.05330  0.01310  0.009094  0.6873  0.7874  0.1239  0.9939  0.009989  0.003960  0.04433  0.1650  0.01350  0.6457  0.01320  0.3015  0.003788  0.3469  1.005  0.3295  0.4249  0.1412  0.09227  0.7530  0.7075  0.01093]';
nitri2_freference=[0.1133  0.02989  0.06354  0.02531  0.05956  0.04676  0.04380  0.03382  0.03749  0.03986  0.3223  0.2471  0.04870  0.03764  0.02372  0.03520  0.2913  0.1974  0.09952  0.01837  0.07488  0.03447  0.03775  0.1150  0.07415  0.3307  0.02381  0.001456  0.04374  0.1447  0.1059  0.1019  0.1546  0.05925  0.02816  0.08491  0.03562  0.03886]';
oxic_freference=[0.9691  0.5989  1.157  0.5718  0.8059  1.018  0.6868  0.7818  0.8910  1.902  1.372  1.021  0.5447  1.421  0.6007  0.6414  1.670  1.080  1.021  1.508  0.8170  0.5619  0.7181  1.069  0.9730  0.9033  0.6026  0.1370  0.7861  1.130  1.713  1.568  1.203  1.101  0.6000  1.413  1.293  0.965]';
dno2_freference=[0.05615  0.007662  0.01393  0.007294  0.01250  0.01529  0.01046  0.01141  0.01254  0.02923  0.03178  0.08106  0.005649  0.01741  0.005848  0.006469  0.03439  0.2072  0.01703  0.4139  0.01114  0.008167  0.01077  0.01954  0.01266  0.01784  0.005865  0.4774  0.01114  0.02432  0.5620  0.03142  0.01699  0.01273  0.005495  0.1487  0.8272  0.01435]';
dno3_freference=[0.0000  0.0000  0.02278  0.0000  8.423E-04  0.0000  0.0000  0.0000  0.0000  0.0000  0.04392  0.009736  0.009657  0.002730  0.0000  0.0000  0.04134  0.0000  2.740E-05  0.0000  0.0000  0.0000  0.0000  0.009667  0.0000  0.03465  0.0000  0.0000  0.0000  0.0000  0.3825  0.0000  0.002331  0.0000  0.01882  0.0000  0.0000  0.0000]';
srra_freference=[0.005668  8.318E-04  3.057E-04  8.170E-04  0.001231  0.001735  0.001015  0.001205  0.001245  0.002883  7.899E-04  0.006538  1.303E-04  0.001553  6.712E-04  6.670E-04  0.001026  0.02090  0.001504  0.2302  9.792E-04  8.395E-04  0.001083  0.001299  0.001117  2.646E-04  6.732E-04  3.717  0.001077  0.002459  0.04258  0.003080  0.001490  0.001360  4.924E-05  0.01825  0.1766  0.001432];
soxo_freference=[0.02474  0.001030  0.002807  0.001104  0.001053  0.001551  0.001528  0.002140  0.005545  0.07383  6.646E-04  0.004541  1.522E-04  0.003661  7.188E-04  7.112E-04  7.725E-04  0.04620  0.001835   1.405  0.001797  0.001103  0.001577  8.118E-04  0.004554  2.640E-04  7.190E-04  0.6668  0.001358  0.002284  0.1274  0.002589  0.001376  0.001194  5.724E-05  0.03702  0.2376  0.001889]';
soxno2_freference=[5.302E-05  4.178E-07  1.652E-06  4.287E-07  5.485E-07  6.974E-07  8.831E-07  1.028E-06  2.838E-06  4.268E-05  7.412E-07  1.583E-05  6.279E-08  1.656E-06  2.064E-07  2.448E-07  7.394E-07  3.629E-04  1.407E-06  0.006176  1.144E-06  5.505E-07  8.419E-07  5.228E-07  2.745E-06  2.537E-07  2.064E-07  0.003595  7.316E-07  1.776E-06  0.001411  1.932E-06  7.050E-07  4.473E-07  1.592E-08  1.175E-04  0.003174  1.012E-06]';
soxno3_freference=[3.841E-07  1.101E-08  8.118E-06  9.807E-09  1.425E-06  3.652E-07  2.436E-08  3.888E-07  5.947E-08  1.772E-06  3.143E-06  3.231E-05  3.671E-07  3.477E-06  5.978E-08  1.496E-07  3.132E-06  1.401E-04  1.333E-06  1.400E-21  3.123E-07  1.687E-08  2.795E-07  2.293E-06  6.706E-07  1.181E-06  5.992E-08  2.392E-21  1.383E-08  1.822E-06  0.007871  2.289E-06  1.960E-06  8.087E-07  1.684E-07  1.028E-06  6.253E-04  3.005E-08]';

Cruise=(metadata.Yearday<125)*1+(metadata.Yearday>125&metadata.Yearday<175)*2+(metadata.Yearday>175&metadata.Yearday<225)*3+(metadata.Yearday>225)*4;
Surf=metadata.Depth<2;
Bot=metadata.Depth>2;
%% Plot against observations
colormap("default")
cmap=colormap;
colormap(cmap([1 86 171 255],:))

figure(2);clf
subplot(331)
mnlim=floor(min([metadata.TEMP' temp_freference']));
mxlim=ceil(max([metadata.TEMP' temp_freference']));
scatter(metadata.TEMP(Surf),temp_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k')
scatter(metadata.TEMP(Bot),temp_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(a) Temperature (^\circ C)')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.TEMP-temp_freference).^2)/std(metadata.TEMP.^2);
text((mnlim+mxlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
ylabel('Model Predictions')

%hc=colorbar('Location',['eastoutside']);

subplot(332)
mnlim=floor(min([metadata.SALT' salt_freference']*10))/10;
mxlim=ceil(max([metadata.SALT' salt_freference']*10))/10;
scatter(metadata.SALT(Surf),salt_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k')
scatter(metadata.SALT(Bot),salt_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(b) Salinity (PSU)')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.SALT-salt_freference).^2)/std(metadata.SALT.^2);
text((mnlim+mxlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
%hc=colorbar('Location',['eastoutside']);

subplot(333)
mnlim=floor(min([metadata.CHLA' chl_freference']));
mxlim=ceil(max([metadata.CHLA' chl_freference']));
scatter(metadata.CHLA(Surf),chl_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
scatter(metadata.CHLA(Bot),chl_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(c) Chl a (mg/m^3)')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.CHLA-chl_freference).^2)/std(metadata.CHLA.^2);
text(mnlim+(mxlim-mnlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
%hc=colorbar('Location',['eastoutside']);

subplot(334)
mnlim=floor(min([metadata.DO' DO_freference']));
mxlim=ceil(max([metadata.DO' DO_freference']));
scatter(metadata.DO(Surf),DO_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
scatter(metadata.DO(Bot),DO_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(d) Oxygen (\muM)')
ylabel('Model Predictions')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.DO-DO_freference).^2)/std(metadata.DO.^2);
text((mnlim+mxlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
ylabel('Model Predictions')
%hc=colorbar('Location',['eastoutside']);

subplot(335)
mnlim=floor(min([metadata.PH' pH_freference]));
mxlim=ceil(max([metadata.PH' pH_freference]));
scatter(metadata.PH(Surf),pH_freference(Surf)',40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
scatter(metadata.PH(Bot),pH_freference(Bot)',40,Cruise(Bot),'filled','d');
title('\rm(e) pH')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.PH-pH_freference').^2)/std(metadata.PH.^2);
text(mnlim+(mxlim-mnlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
%hc=colorbar('Location',['eastoutside']);


subplot(336)
mnlim=floor(min([metadata.PO4F' po4_freference']));
mxlim=ceil(max([metadata.PO4F' po4_freference']));
scatter(metadata.PO4F(Surf),po4_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
scatter(metadata.PO4F(Bot),po4_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(f) Phosphate (\mu M)')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.PO4F-po4_freference).^2)/std(metadata.PO4F.^2);
text(mnlim+(mxlim-mnlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
%hc=colorbar('Location',['eastoutside']);

subplot(337)
mnlim=floor(min([metadata.NH4F' nh4_freference']));
mxlim=ceil(max([metadata.NH4F' nh4_freference']));
scatter(metadata.NH4F(Surf),nh4_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
scatter(metadata.NH4F(Bot),nh4_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(g) Ammonium (\mu M)')
ylabel('Model Predictions')
xlabel('Observations')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.NH4F-nh4_freference).^2)/std(metadata.NH4F.^2);
text((mnlim+mxlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
ylabel('Model Predictions')
xlabel('Observations')
%hc=colorbar('Location',['eastoutside']);

subplot(338)
mnlim=floor(min(([metadata.NO3F' no3_freference'])));
mxlim=ceil(max(([metadata.NO3F' no3_freference'])));
scatter(metadata.NO3F(Surf),no3_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
scatter(metadata.NO3F(Bot),no3_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(h) Nitrate (\mu M)')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean(((metadata.NO3F)-(no3_freference)).^2)/std((metadata.NO3F).^2);
text((mnlim+mxlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
xlabel('Observations')
%hc=colorbar('Location',['eastoutside']);
text(-15,-25,'Circles, Surface; Diamonds, Bottom')

subplot(339)
mnlim=floor(min([metadata.NO23F' no2_freference'+no3_freference']));
mxlim=ceil(max([metadata.NO23F' no2_freference'+no3_freference']));
scatter(metadata.NO23F(Surf),no2_freference(Surf)+no3_freference(Surf),40,Cruise(Surf),'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
scatter(metadata.NO23F(Bot),no2_freference(Bot)+no3_freference(Bot),40,Cruise(Bot),'filled','d');
title('\rm(i) Nitrate+Nitrite (\mu M)')
xlabel('Observations')
axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([0.5 4.5])
COD=1-mean((metadata.NO23F-no2_freference-no3_freference).^2)/std(metadata.NO23F.^2);
text((mnlim+mxlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])
xlabel('Observations')
%hc=colorbar('Location',['eastoutside']);

%hc1=colorbar();
%hc1.Position =[0.05 0.35 0.02 0.3];
%xlabel(hc1,'Cruise Month');
%labelsc={'Apr','Jun','Jul','Aug'}
%hc1.Label.Rotation=0;
%hc1.Label.Position=[0.08 0.35 0];
%hc1.Direction="reverse";
%hc1.Ticks=(1:4);
%hc1.TickLabels=labelsc;

colormap("default")
cmap=colormap;
colormap(cmap([1 86 171 255],:))
hc1=colorbar();
caxis([0.5 4.5])
hc1.Position =[0.05 0.35 0.02 0.3];
xlabel(hc1,'Cruise Month');
labelsc={'Apr','Jun','Jul','Aug'}
hc1.Label.Rotation=0;
hc1.Label.Position=[0.08 0.35 0];
hc1.Direction="reverse";
hc1.Ticks=(1:4);
hc1.TickLabels=labelsc;

%subplot(338)
%mnlim=floor(min([metadata.PH' pH_freference]));
%mxlim=ceil(max([metadata.PH' pH_freference]));
%scatter(metadata.PH,pH_freference,40,metadata.Yearday,'filled');hold on;plot([mnlim mxlim],[mnlim mxlim],'k');
%title('(e) PH')
%axis('square');axis([mnlim mxlim mnlim mxlim]);caxis([100 250])
%COD=1-mean((metadata.PH-pH_freference').^2)/std(metadata.PH.^2);
%text(mnlim+(mxlim-mnlim)*0.4,mnlim+(mxlim-mnlim)/10,['COD=' num2str(COD,'%5.3f')])





